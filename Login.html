<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth0 Login </title>
  <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=p2L4y_NtsvqsqwCYbDXCeMq5OR-XPeBryL8xplQdlfT6jNRvjZhSzg2AsVT4KIVpQmDKuZDsAvBhwOWLT8t3sA" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://gc.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9rYW55YWRldHNjaG9vbC0yLndlYi5hcHAvTG9naW4uaHRtbA"/><script src="https://cdn.auth0.com/js/auth0-spa-js/1.19.3/auth0-spa-js.production.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Poppins:600&display=swap" rel="stylesheet">
	<script src="https://kit.fontawesome.com/a81368914c.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

  <img class="wave" src="img/wave.png">
	<div class="container">
		<div class="img">
			<img src="img/bg.svg">
		</div>
		<div class="login-content">
			<form>
				<img src="img/avatar.svg">
				<img src="https://th.bing.com/th/id/R.a7ca5d4ad57252b0b1c64aec43189dee?rik=zTMY69dK4soHvw&pid=ImgRaw&r=0">
				<img src="https://kanyadetschool-2.web.app/images/newlogo.png">
				<h2 class="title">Welcome BACK</h2>
           		<div class="input-div one">
           		   <div class="i">
           		   		<i class="fas fa-user"></i>
           		   </div>
					  <button id="login-btn" class="btn">Log In</button>
			</div>
		</div>
		
	</form>

  <!-- Logout Button -->
  <button id="logout-btn" style="display: none;">Log Out</button>

  <!-- User Info Display -->
  <div id="user-info" style="display: none;">
    <h2>User Information:</h2>
    <pre id="user-data"></pre>
  </div>

  <script>
    // Global variable to hold the Auth0 client instance
    let auth0 = null;

    // Initialize Auth0 client
    const initAuth0 = async () => {
      auth0 = await createAuth0Client({
        domain: "dev-glxfyfbedo8ukc2v.us.auth0.com",
        client_id: "2XOYAwhUhPrlOlOaj1vkqaYCdWDHzTLm"
      });
    };

    // Handle login
    const login = async () => {
      await auth0.loginWithRedirect({
        redirect_uri: window.location.origin
      });
    };

    // Handle logout
    const logout = () => {
      auth0.logout({
        returnTo: window.location.origin
      });
    };

    // Handle authentication redirect and user information display
    const handleRedirect = async () => {
      const query = window.location.search;

      // Check if the user is coming back from the Auth0 redirect
      if (query.includes("code=") && query.includes("state=")) {
        await auth0.handleRedirectCallback();
        window.history.replaceState({}, document.title, window.location.pathname); // Clean the URL
      }

      // Get the user's authentication state
      const isAuthenticated = await auth0.isAuthenticated();

      if (isAuthenticated) {
        // Show the logout button and user information
        document.getElementById("logout-btn").style.display = "block";
        document.getElementById("user-info").style.display = "block";

        // Hide the login button
        document.getElementById("login-btn").style.display = "none";

        // Get the user's profile information
        const user = await auth0.getUser();
        document.getElementById("user-data").textContent = JSON.stringify(user, null, 2);
      } else {
        // Show the login button
        document.getElementById("login-btn").style.display = "block";

        // Hide the logout button and user information
        document.getElementById("logout-btn").style.display = "none";
        document.getElementById("user-info").style.display = "none";
      }
    };

    // Initialize Auth0 and handle redirect when the page loads
    window.onload = async () => {
      await initAuth0();
      await handleRedirect();
    };

    // Add event listeners for login and logout buttons
    document.getElementById("login-btn").addEventListener("click", login);
    document.getElementById("logout-btn").addEventListener("click", logout);

  </script>
   <script type="text/javascript" src="js/main.js"></script>

</body>
</html>
